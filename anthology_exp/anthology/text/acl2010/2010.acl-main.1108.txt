    Efficient Inference Through Cascades of Weighted Tree Transducers

          Jonathan May and Kevin Knight                                   Heiko Vogler
            Information Sciences Institute                     Technische Universität Dresden
           University of Southern California                 Institut für Theoretische Informatik
              Marina del Rey, CA 90292                             01062 Dresden, Germany
          {jonmay,knight}@isi.edu                           heiko.vogler@tu-dresden.de



                     Abstract                                1997). Less well-studied but of more recent in-
                                                             terest is application of cascades of weighted tree
    Weighted tree transducers have been pro-                 transducers (WTTs). We tackle application of WTT
    posed as useful formal models for rep-                   cascades in this work, presenting:
    resenting syntactic natural language pro-                • explicit algorithms for application of WTT cas-
    cessing applications, but there has been                   cades
    little description of inference algorithms               • novel algorithms for on-the-fly application of
    for these automata beyond formal founda-                   WTT cascades, and
    tions. We give a detailed description of                 • experiments comparing the performance of
    algorithms for application of cascades of                  these algorithms.
    weighted tree transducers to weighted tree
    acceptors, connecting formal theory with                 2       Strategies for the string case
    actual practice. Additionally, we present                Before we discuss application of WTTs, it is help-
    novel on-the-fly variants of these algo-                 ful to recall the solution to this problem in the WST
    rithms, and compare their performance                    domain. We recall previous formal presentations
    on a syntax machine translation cascade                  of WSTs (Mohri, 1997) and note informally that
    based on (Yamada and Knight, 2001).                      they may be represented as directed graphs with
                                                             designated start and end states and edges labeled
1   Motivation                                               with input symbols, output symbols, and weights.1
Weighted finite-state transducers have found re-             Fortunately, the solution for WSTs is practically
cent favor as models of natural language (Mohri,             trivial—we achieve application through a series
1997). In order to make actual use of systems built          of embedding, composition, and projection oper-
with these formalisms we must first calculate the            ations. Embedding is simply the act of represent-
set of possible weighted outputs allowed by the              ing a string or regular string language as an iden-
transducer given some input, which we call for-              tity WST. Composition of WSTs, that is, generat-
ward application, or the set of possible weighted            ing a single WST that captures the transformations
inputs given some output, which we call backward             of two input WSTs used in sequence, is not at all
application. After application we can do some in-            trivial, but has been well covered in, e.g., (Mohri,
ference on this result, such as determining its k            2009), where directly implementable algorithms
highest weighted elements.                                   can be found. Finally, projection is another triv-
   We may also want to divide up our problems                ial operation—the domain or range language can
into manageable chunks, each represented by a                be obtained from a WST by ignoring the output or
transducer. As noted by Woods (1980), it is eas-             input symbols, respectively, on its arcs, and sum-
ier for designers to write several small transduc-           ming weights on otherwise identical arcs. By em-
ers where each performs a simple transformation,             bedding an input, composing the result with the
rather than painstakingly construct a single com-            given WST, and projecting the result, forward ap-
plicated device. We would like to know, then,                plication is accomplished.2 We are then left with
the result of transformation of input or output by           a weighted string acceptor (WSA), essentially a
a cascade of transducers, one operating after the            weighted, labeled graph, which can be traversed
other. As we will see, there are various strate-                 1
                                                                   We assume throughout this paper that weights are in
gies for approaching this problem. We will con-              R+ ∪ {+∞}, that the weight of a path is calculated as the
sider offline composition, bucket brigade applica-           product of the weights of its edges, and that the weight of a
tion, and on-the-fly application.                            (not necessarily finite) set T of paths is calculated as the sum
                                                             of the weights of the paths of T .
   Application of cascades of weighted string                    2
                                                                   For backward applications, the roles of input and output
transducers (WSTs) has been well-studied (Mohri,             are simply exchanged.


                                                       1058
      Proceedings of the 48th Annual Meeting of the Association for Computational Linguistics, pages 1058–1066,
                Uppsala, Sweden, 11-16 July 2010. c 2010 Association for Computational Linguistics


                                                                                                                                                                                              a       :       a   /   1                                                                                                                                       a   :   a   /   1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              a                       :           b           /                   .       1                                                                                   a               :               a                       /                   .           9
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            a                               :           d                           /                   .       4



                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                a                       :           a               /               .           6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                a                   :       c       /   .       6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      b                           :               b                       /                   .   5




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b               :               a               /               .       5




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            F




                                                                                  A                                                                                                                                                                                   B                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 E

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          a               :           b                   /                   .       4


                                                                                                                                                                                                                                                                                                                                                                                                                                  C                                                                                                                                                                                           b                   :       a                           /           .                   5                                                                                                       D




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b                           :       b               /                       .   5




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            b

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            :           d                           /                   .       3

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    :       c       /   .       7




(a) Input string “a a” embedded in an                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         (b) first WST in cascade                                                                                                                                                                                                                                                                                                                                                                                                                                                          (c) second WST in cascade
identity WST
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /               .   0           7




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c




                                                                                                      a                               :                   c                   /       .   0               7                                                                                                                                                                                   a                       :   c                           /                   .           3                               6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                B                       D                                   F                                                                                                                                                       C

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    /           .           0                               7




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        c

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                D                                       F




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                d                   /                   .   0       3




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          a                           :   b                       /       .       1


                                  a                           :   d                               /                       .       0                                   3                                                               a                       :               c           /               .                       5               4                                                                                           a                   :               d                           /               .               2                   4




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    d                       /       .           0                       3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    D




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /               .       5                       4


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      B       D                                                                                                                                                     C




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c




              b                                                                                                                                                                                                                                                                                                                                                                                                                                                               b




                                      :           c                       /                   .                   6                               5                                                                               a                       :               d                   /               .               3                       6                                                                                                                                               :           c                       /                   .       6                   5

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /               .                   2           8




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        A                           D                               F
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            d               /               .           3                           6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  A                           D




  b

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              b




                  :           d                       /               .       3                                       5
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                d                               /               .                   1               2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          :       d                       /               .           3                   5




                                                                                                                                                                                                                              a               :                   c                   /               .               2                   8




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        B                       E                           F




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          B       E




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                c                   /                   .           5                   4
                                                                                                                                                                                                                                                                                                                                                                                      E                   F


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      a                       :       a               /       .           9
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            c                   /               .                       3               6

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        E


                                                                                                                                                      D                           F
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            E                                       F




                                                                                                                                                                                                                          a               :       d                               /               .               1                           2




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            C




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            d                           /                   .   3                           6


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                d                       /               .                   2               4




(d) Offline composition approach:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             (e) Bucket brigade approach:                                                                                                                                                                                                                                                                                                                                                                                                                                                                          (f) Result of offline or bucket application
Compose the transducers                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Apply WST (b) to WST (a)                                                                                                                                                                                                                                                                                                                                                                                                                                                                              after projection
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          /           .               0                               7




                                                                                                                                          /                   .           0                       7




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          c




                                                                                                              c




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                /                   .       0                   7




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                c




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      d                       /               .           0                   3




                                                                                                          d                                   /                   .           0               3


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          /       .       2       8




                                                                                                                                                                                                                                                                                                                                                                                                                                                                      /                       .           2                           8

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  B       D       F                                                                                                                                                             C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                D                           F

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  c

                                                                                                                                                                                                                                                                                      B                                   D                               F                                                                                                                                                                                                                                                                                                                               C                                                                                                                                                                                                                                                                                                                                                                                                                                 d                       /                   .       0           3
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          D                               F
                                                                                                                                                                                                                                                                                                                                                                                                                                                  c




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            /           .                   2                       8




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                B               D           F                                                                                                                                                                                                                                           C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    D                                       F
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  d                               /           .       1       2




                                                                                                                                                                                                                                                                                                                                                                                                                                      d                       /                           .       1                               2




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            d           /           .               1                       2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              A               D                   F




                                              A                                       D                                       F




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                A                           D                               F




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      B               E       F




                                                                                                                                                                                                                                                      B                                   E                                           F


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      c                       /           .           5       4

                      /                   .               5                   4

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    B                   E           F




          c                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             c                       /           .                   5           4




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  c               /                   .       3                               6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            C
                                                                                                                                                                                                                                                                                                                                                                                      c           /               .           3                           6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             E                   F



                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  E                           F




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                C
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        E                               F
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    c               /               .               3                   6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  d                               /           .   3               6




      d                   /                   .       3                                   6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    d                               /           .           3                   6




                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      d               /                   .       2                       4




                                                                                                                                                                                                                                                                                                                                                                                  d       /           .       2                           4



                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        d                       /                       .       2               4




(g) Initial on-the-fly                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (h) On-the-fly stand-in after exploring                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (i) On-the-fly stand-in after best path has been found
stand-in for (f)                                                                                                                                                                                                                                                                                                                                                                                                                                                                              outgoing edges of state ADF

                                                                                                                                                                                                                          Figure 1: Three different approaches to application through cascades of WSTs.


by well-known algorithms to efficiently find the k-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       3           Application of tree transducers
best paths.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               Now let us revisit these strategies in the setting
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          of trees and tree transducers. Imagine we have a
   Because WSTs can be freely composed, extend-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           tree or set of trees as input that can be represented
ing application to operate on a cascade of WSTs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           as a weighted regular tree grammar3 (WRTG) and
is fairly trivial. The only question is one of com-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       a WTT that can transform that input with some
position order: whether to initially compose the                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          weight. We would like to know the k-best trees the
cascade into a single transducer (an approach we                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          WTT can produce as output for that input, along
call offline composition) or to compose the initial                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       with their weights. We already know of several
embedding with the first transducer, trim useless                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         methods for acquiring k-best trees from a WRTG
states, compose the result with the second, and so                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        (Huang and Chiang, 2005; Pauls and Klein, 2009),
on (an approach we call bucket brigade). The ap-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          so we then must ask if, analogously to the string
propriate strategy generally depends on the struc-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        case, WTTs preserve recognizability4 and we can
ture of the individual transducers.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       form an application WRTG. Before we begin, how-
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          ever, we must define WTTs and WRTGs.
   A third approach builds the result incrementally,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          3.1          Preliminaries5
as dictated by some algorithm that requests in-
formation about it. Such an approach, which we                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            A ranked alphabet is a finite set Σ such that ev-
call on-the-fly, was described in (Pereira and Ri-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ery member σ ∈ Σ has a rank rk(σ) ∈ N. We
ley, 1997; Mohri, 2009; Mohri et al., 2000). If                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           call Σ(k) ⊆ Σ, k ∈ N the set of those σ ∈ Σ
we can efficiently calculate the outgoing edges of                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        such that rk(σ) = k. The set of variables is de-
a state of the result WSA on demand, without cal-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         noted X = {x1 , x2 , . . .} and is assumed to be dis-
culating all edges in the entire machine, we can                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          joint from any ranked alphabet used in this paper.
maintain a stand-in for the result structure, a ma-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       We use ⊥ to denote a symbol of rank 0 that is not
chine consisting at first of only the start state of                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      in any ranked alphabet used in this paper. A tree
the true result. As a calling algorithm (e.g., an im-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     t ∈ TΣ is denoted σ(t1 , . . . , tk ) where k ≥ 0,
plementation of Dijkstra’s algorithm) requests in-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        σ ∈ Σ(k) , and t1 , . . . , tk ∈ TΣ . For σ ∈ Σ(0) we
formation about the result graph, such as the set of
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              3
outgoing edges from a state, we replace the current                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             This generates the same class of weighted tree languages
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          as weighted tree automata, the direct analogue of WSAs, and
stand-in with a richer version by adding the result                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       is more useful for our purposes.
of the request. The on-the-fly approach has a dis-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                A weighted tree language is recognizable iff it can be
tinct advantage over the other two methods in that                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        represented by a wrtg.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              5
the entire result graph need not be built. A graphi-                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The following formal definitions and notations are
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          needed for understanding and reimplementation of the pre-
cal representation of all three methods is presented                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      sented algorithms, but can be safely skipped on first reading
in Figure 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              and consulted when encountering an unfamiliar term.


                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      1059


write σ ∈ TΣ as shorthand for σ(). For every set                    A WRTG G is in normal form if each produc-
S disjoint from Σ, let TΣ (S) = TΣ∪S , where, for                   tion is either a chain production or is of the
                                                                                  w
all s ∈ S, rk(s) = 0.                                               form n −      → σ(n1 , . . . , nk ) where σ ∈ Σ(k) and
    We define the positions of a tree                               n1 , . . . , n k ∈ N .
t = σ(t1 , . . . , tk ), for k ≥ 0, σ ∈ Σ(k) ,                         For WRTG G = (N, Σ, P, n0 ), s, t, u ∈ TΣ (N ),
t1 , . . . , tk ∈ TΣ , as a set pos(t) ⊂ N∗ such that               n ∈ N , and p ∈ P of the form n −
                                                                                                                 w
                                                                                                                 → u, we
pos(t) = {ε} ∪ {iv | 1 ≤ i ≤ k, v ∈ pos(ti )}.                      obtain a derivation step from s to t by replacing
The set of leaf positions lv(t) ⊆ pos(t) are those                  some leaf nonterminal in s labeled n with u. For-
positions v ∈ pos(t) such that for no i ∈ N,                        mally, s ⇒pG t if there exists some v ∈ lv(s)
vi ∈ pos(t). We presume standard lexicographic                      such that s(v) = n and s[u]v = t. We say this
orderings < and ≤ on pos.                                           derivation step is leftmost if, for all v 0 ∈ lv(s)
    Let t, s ∈ TΣ and v ∈ pos(t). The label of t                    where v 0 < v, s(v 0 ) ∈ Σ. We henceforth as-
at position v, denoted by t(v), the subtree of t at                 sume all derivation steps are leftmost. If, for
v, denoted by t|v , and the replacement at v by s,                  some m ∈ N, pi ∈ P , and ti ∈ TΣ (N ) for all
denoted by t[s]v , are defined as follows:                          1 ≤ i ≤ m, n0 ⇒p1 t1 . . . ⇒pm tm , we say
1. For every σ ∈ Σ(0) , σ(ε) = σ, σ|ε = σ, and                      the sequence d = (p1 , . . . , pm ) is a derivation
    σ[s]ε = s.                                                      of tm in G and that n0 ⇒∗ tm ; the weight of d
2. For every t = σ(t1 , . . . , tk ) such that                      is wt(d) = π(p1 ) · . . . · π(pm ). The weighted
    k = rk(σ) and k ≥ 1, t(ε) = σ, t|ε = t,                         tree language recognized by G is the mapping
    and t[s]ε = s. For every 1 ≤ i ≤ k and                          LG : TΣ → R∞       + such that for every t ∈ TΣ , LG (t)
    v ∈ pos(ti ), t(iv) = ti (v), t|iv = ti |v , and                is the sum of the weights of all (possibly infinitely
    t[s]iv = σ(t1 , . . . , ti−1 , ti [s]v , ti+1 , . . . , tk ).   many) derivations of t in G. A weighted tree lan-
   The size of a tree t, size (t) is |pos(t)|, the car-             guage f : TΣ → R∞       + is recognizable if there is a
dinality of its position set. The yield set of a tree               WRTG G such that f = LG .
is the set of labels of its leaves: for a tree t, yd (t)               We define a partial ordering  on WRTGs
= {t(v) | v ∈ lv(t)}.                                               such that for WRTGs G1 = (N1 , Σ, P1 , n0 ) and
   Let A and B be sets. Let ϕ : A → TΣ (B)                          G2 = (N2 , Σ, P2 , n0 ), we say G1  G2 iff
be a mapping. We extend ϕ to the mapping ϕ :                        N1 ⊆ N2 and P1 ⊆ P2 , where the weights are
TΣ (A) → TΣ (B) such that for a ∈ A, ϕ(a) = ϕ(a)                    preserved.
and for k ≥ 0, σ ∈ Σ(k) , and t1 , . . . , tk ∈ TΣ (A),
ϕ(σ(t1 , . . . , tk )) = σ(ϕ(t1 ), . . . , ϕ(tk )). We indi-        Definition 3.2 (cf. Def. 1 of (Maletti, 2008))
cate such extensions by describing ϕ as a substi-                   A weighted extended top-down tree transducer
tution mapping and then using ϕ without further                     (WXTT) is a 5-tuple M = (Q, Σ, ∆, R, q0 ) where:
comment.                                                            1. Q is a finite set of states.
   We use R+ to denote the set {w ∈ R | w ≥ 0}                      2. Σ and ∆ are the ranked alphabets of in-
and R∞ + to denote R+ ∪ {+∞}.                                          put and output symbols, respectively, where
                                                                       (Σ ∪ ∆) ∩ Q = ∅.
Definition 3.1 (cf. (Alexandrakis and Bozapa-                       3. R is a tuple (R0 , π), where R0 is a finite set
lidis, 1987)) A weighted regular tree grammar                          of rules, each rule r of the form q.y −
                                                                                                             → u for
(WRTG) is a 4-tuple G = (N, Σ, P, n0 ) where:                          q ∈ Q, y ∈ TΣ (X), and u ∈ T∆ (Q × X).
1. N is a finite set of nonterminals, with n0 ∈ N                      We further require that no variable x ∈ X ap-
   the start nonterminal.                                              pears more than once in y, and that each vari-
2. Σ is a ranked alphabet of input symbols, where                      able appearing in u is also in y. Moreover,
   Σ ∩ N = ∅.                                                          π : R 0 → R∞     + is a weight function of the
3. P is a tuple (P 0 , π), where P 0 is a finite set                   rules. As for WRTGs, we refer to R as a finite
   of productions, each production p of the form                       set of weighted rules, each rule r of the form
   n− → u, n ∈ N , u ∈ TΣ (N ), and π : P 0 → R+                            π(r)
                                                                       q.y −−→ u.
   is a weight function of the productions. We will
   refer to P as a finite set of weighted produc-                      A WXTT is linear (respectively, nondeleting)
                                                       π(p)                                                     w
   tions, each production p of the form n −−→ u.                    if, for each rule r of the form q.y −       → u, each
                                                                    x ∈ yd (y) ∩ X appears at most once (respec-
  A production p is a chain production if it is                     tively, at least once) in u. We denote the class
                w
of the form ni −→ nj , where ni , nj ∈ N .6                         of all WXTTs as wxT and add the letters L and N
    6                                                               to signify the subclasses of linear and nondeleting
      In (Alexandrakis and Bozapalidis, 1987), chain produc-
tions are forbidden in order to avoid infinite summations. We       WTT, respectively. Additionally, if y is of the form
explicitly allow such summations.                                   σ(x1 , . . . , xk ), we remove the letter “x” to signify


                                                                1060


the transducer is not extended (i.e., it is a “tradi-              plication WRTG M (G). and if M preserves back-
tional” WTT (Fülöp and Vogler, 2009)).                           ward recognizability, we can call the backward ap-
    For WXTT M = (Q, Σ, ∆, R, q0 ), s, t ∈ T∆ (Q                   plication WRTG M (G)/ .
                                        w
× TΣ ), and r ∈ R of the form q.y −     → u, we obtain                Now that we have explained the application
a derivation step from s to t by replacing some                    problem in the context of weighted tree transduc-
leaf of s labeled with q and a tree matching y by a                ers and determined the classes for which applica-
transformation of u, where each instance of a vari-                tion is possible, let us consider how to build for-
able has been replaced by a corresponding subtree                  ward and backward application WRTGs. Our ba-
of the y-matching tree. Formally, s ⇒rM t if there                 sic approach mimics that taken for WSTs by us-
is a position v ∈ pos(s), a substitution mapping                   ing an embed-compose-project strategy. As in
                                    w                              string world, if we can embed the input in a trans-
ϕ : X → TΣ , and a rule q.y −       → u ∈ R such that
s(v) = (q, ϕ(y)) and t = s[ϕ0 (u)]v , where ϕ0 is                  ducer, compose with the given transducer, and
a substitution mapping Q × X → T∆ (Q × TΣ )                        project the result, we can obtain the application
defined such that ϕ0 (q 0 , x) = (q 0 , ϕ(x)) for all              WRTG . Embedding a WRTG in a wLNT is a triv-
q 0 ∈ Q and x ∈ X. We say this derivation step                     ial operation—if the WRTG is in normal form and
is leftmost if, for all v 0 ∈ lv(s) where v 0 < v,                 chain production-free,8 for every production of the
                                                                             w
s(v 0 ) ∈ ∆. We henceforth assume all derivation                   form n −  → σ(n1 , . . . , nk ), create a rule of the form
                                                                                         w
steps are leftmost. If, for some s ∈ TΣ , m ∈ N,                   n.σ(x1 , . . . , xk ) −
                                                                                         → σ(n1 .x1 , . . . , nk .xk ). Range
ri ∈ R, and ti ∈ T∆ (Q × TΣ ) for all 1 ≤ i ≤ m,                   projection of a wxLNT is also trivial—for every
(q0 , s) ⇒r1 t1 . . . ⇒rm tm , we say the sequence                 q ∈ Q and u ∈ T∆ (Q × X) create a production
d = (r1 , . . . , rm ) is a derivation of (s, tm ) in M ;                              w
                                                                   of the form q −     → u0 where u0 is formed from u
the weight of d is wt(d) = π(r1 ) · . . . · π(rm ).                by replacing all leaves of the form q.x with the
The weighted tree transformation recognized by                     leaf q, i.e., removing references to variables, and
M is the mapping τM : TΣ × T∆ → R∞              + , such           w is the sum of the weights of all rules of the form
that for every s ∈ TΣ and t ∈ T∆ , τM (s, t) is the                q.y − → u in R.9 Domain projection for wxLT is
sum of the weights of all (possibly infinitely many)               best explained by way of example. The left side of
derivations of (s, t) in M . The composition of two                a rule is preserved, with variables leaves replaced
weighted tree transformations τ : TΣ ×T∆ → R∞          +           by their associated states from the right side. So,
and µ : T∆ × TΓ → R∞       + is the weighted tree trans-           the rule q1 .σ(γ(x1 ), x2 ) −
                                                                                                  w
                                                                                                  → δ(q2 .x2 , β(α, q3 .x1 ))
formation (τ ; µ) : TΣ × TΓ → R∞      + where
                                         P for every                                                     w
s ∈ TΣ and u ∈ TΓ , (τ ; µ)(s, u) = t∈T∆ τ (s, t)                  would yield the production q1 −       → σ(γ(q3 ), q2 ) in
                                                                   the domain projection. However, a deleting rule
· µ(t, u).                                                                                    w
                                                                   such as q1 .σ(x1 , x2 ) −  → γ(q2 .x2 ) necessitates the
3.2    Applicable classes                                          introduction of a new nonterminal ⊥ that can gen-
We now consider transducer classes where recog-                    erate all of TΣ with weight 1.
nizability is preserved under application. Table 1                    The only missing piece in our embed-compose-
presents known results for the top-down tree trans-                project strategy is composition. Algorithm 1,
ducer classes described in Section 3.1. Unlike                     which is based on the declarative construction of
the string case, preservation of recognizability is                Maletti (2006), generates the syntactic composi-
not universal or symmetric. This is important for                  tion of a wxLT and a wLNT, a generalization
us, because we can only construct an application                   of the basic composition construction of Baker
WRTG , i.e., a WRTG representing the result of ap-                 (1979). It calls Algorithm 2, which determines
plication, if we can ensure that the language gen-                 the sequences of rules in the second transducer
erated by application is in fact recognizable. Of                  that match the right side of a single rule in the
the types under consideration, only wxLNT and                      first transducer. Since the embedded WRTG is of
wLNT preserve forward recognizability. The two                     type wLNT, it may be either the first or second
classes marked as open questions and the other                     argument provided to Algorithm 1, depending on
classes, which are superclasses of wNT, do not or                  whether the application is forward or backward.
are presumed not to. All subclasses of wxLT pre-                   We can thus use the embed-compose-project strat-
serve backward recognizability.7 We do not con-                    egy for forward application of wLNT and back-
sider cases where recognizability is not preserved                 ward application of wxLT and wxLNT. Note that
in the remainder of this paper. If a transducer M                  we cannot use this strategy for forward applica-
of a class that preserves forward recognizability is
                                                                      8
applied to a WRTG G, we can call the forward ap-                         Without loss of generality we assume this is so, since
                                                                   standard algorithms exist to remove chain productions
    7                                                              (Kuich, 1998; Ésik and Kuich, 2003; Mohri, 2009) and con-
      Note that the introduction of weights limits recognizabil-
ity preservation considerably. For example, (unweighted) xT        vert into normal form (Alexandrakis and Bozapalidis, 1987).
                                                                       9
preserves backward recognizability.                                      Finitely many such productions may be formed.


                                                               1061


tion of wxLNT, even though that class preserves                   Algorithm 2 COVER
recognizability.                                                     1: inputs
                                                                     2:    u ∈ T∆ (Q1 × X)
                                                                     3:    wT M2 = (Q2 , ∆, Γ, R2 , q20 )
Algorithm 1 COMPOSE                                                  4:    state q2 ∈ Q2
    1: inputs                                                        5: outputs
    2:    wxLT M1 = (Q1 , Σ, ∆, R1 , q10 )                           6:    set of pairs (z, w) with z ∈ TΓ ((Q1 × Q2 ) × X)
    3:    wLNT M2 = (Q2 , ∆, Γ, R2 , q20 )                                 formed by one or more successful runs on u by rules
    4: outputs                                                             in R2 , starting from q2 , and w ∈ R∞
                                                                                                               + the sum of the
    5:    wxLT M3 = ((Q1 × Q2 ), Σ, Γ, R3 , (q10 , q20 )) such             weights of all such runs.
          that M3 = (τM1 ; τM2 ).                                    7: complexity
    6: complexity                                                    8:    O(|R2 |size (u) )
    7:    O(|R1 | max(|R2 |size (ũ) , |Q2 |)), where ũ is the
          largest right side tree in any rule in R1                9: if u(ε) is of the form (q1 , x) ∈ Q1 × X then
                                                                  10:     zinit ← ((q1 , q2 ), x)
 8:    Let R3 be of the form (R30 , π)                            11: else
 9:    R3 ← (∅, ∅)                                                12:     zinit ← ⊥
10:    Ξ ← {(q10 , q20 )} {seen states}                           13: Πlast ← {(zinit , {((ε, ε), q2 )}, 1)}
11:    Ψ ← {(q10 , q20 )} {pending states}                        14: for all v ∈ pos(u) such that u(v) ∈ ∆(k) for some
12:    while Ψ 6= ∅ do                                                k ≥ 0 in prefix order do
13:       (q1 , q2 ) ←any element of Ψ                            15:     Πv ← ∅
                                                                  16:     for all (z, θ, w) ∈ Πlast do
14:       Ψ ← Ψ \ {(q1 , q2 )}
                           w1                                     17:        for all v 0 ∈ lv(z) such that z(v 0 ) = ⊥ do
15:       for all (q1 .y −−→   u) ∈ R1 do                                                                               w0
16:          for all (z, w2 ) ∈ COVER(u, M2 , q2 ) do             18:            for all (θ(v, v 0 ).u(v)(x1 , . . . , xk ) −→ h)∈R2
17:              for all (q, x) ∈ yd (z) ∩ ((Q1 × Q2 ) × X) do                   do
18:                  if q 6∈ Ξ then                               19:               θ0 ← θ
19:                      Ξ ← Ξ ∪ {q}                              20:               Form substitution mapping ϕ : (Q2 × X)
20:                      Ψ ← Ψ ∪ {q}                                                → TΓ ((Q1 × Q2 × X) ∪ {⊥}).
21:              r ← ((q1 , q2 ).y −→ z)                          21:               for i = 1 to k do
                                                                  22:                   for all v 00 ∈ pos(h) such that
22:              R30 ← R30 ∪ {r}
                                                                                        h(v 00 ) = (q20 , xi ) for some q20 ∈ Q2 do
23:              π(r) ← π(r) + (w1 · w2 )
                                                                  23:                      θ0 (vi, v 0 v 00 ) ← q20
24:    return M3                                                  24:                      if u(vi) is of the form
                                                                                           (q1 , x) ∈ Q1 × X then
                                                                  25:                           ϕ(q20 , xi ) ← ((q1 , q20 ), x)
4     Application of tree transducer cascades                     26:                      else
                                                                  27:                           ϕ(q20 , xi ) ← ⊥
What about the case of an input WRTG and a cas-                   28:               Πv ← Πv ∪ {(z[ϕ(h)]v0 , θ0 , w · w0 )}
cade of tree transducers? We will revisit the three               29:      Πlast ← Πv
                                                                  30:   Z ← {z | (z, θ,X  w) ∈ Πlast }
strategies for accomplishing application discussed
                                                                  31:   return {(z,              w) | z ∈ Z}
above for the string case.                                                          (z,θ,w)∈Πlast
   In order for offline composition to be a viable
strategy, the transducers in the cascade must be
closed under composition. Unfortunately, of the                   tion, whereas application for trees is obtained by a
classes that preserve recognizability, only wLNT                  series of (embed, compose, project) operations.
is closed under composition (Gécseg and Steinby,                 4.1     On-the-fly algorithms
1984; Baker, 1979; Maletti et al., 2009; Fülöp and
Vogler, 2009).                                                    We next consider on-the-fly algorithms for ap-
   However, the general lack of composability of                  plication. Similar to the string case, an on-the-
tree transducers does not preclude us from con-                   fly approach is driven by a calling algorithm that
ducting forward application of a cascade. We re-                  periodically needs to know the productions in a
                                                                  WRTG with a common left side nonterminal. The
visit the bucket brigade approach, which in Sec-
tion 2 appeared to be little more than a choice of                embed-compose-project approach produces an en-
composition order. As discussed previously, ap-                   tire application WRTG before any inference al-
plication of a single transducer involves an embed-               gorithm is run. In order to admit an on-the-fly
ding, a composition, and a projection. The embed-                 approach we describe algorithms that only gen-
ded WRTG is in the class wLNT, and the projection                 erate those productions in a WRTG that have a
forms another WRTG. As long as every transducer                   given left nonterminal. In this section we ex-
in the cascade can be composed with a wLNT                        tend Definition 3.1 as follows: a WRTG is a 6-
to its left or right, depending on the application                tuple G = (N, Σ, P, n0 , M , G) where N, Σ, P,
type, application of a cascade is possible. Note                  and n0 are defined as in Definition 3.1, and either
that this embed-compose-project process is some-                  M = G = ∅,10 or M is a wxLNT and G is a nor-
what more burdensome than in the string case. For                 mal form, chain production-free WRTG such that
strings, application is obtained by a single embed-                  10
                                                                        In which case the definition is functionally unchanged
ding, a series of compositions, and a single projec-              from before.


                                                              1062


    type         preserved?                    source
   w[x]T             No                    See w[x]NT                         type          preserved?                source
  w[x]LT            OQ                   (Maletti, 2009)                     w[x]T              No                See w[x]NT
  w[x]NT             No            (Gécseg and Steinby, 1984)               w[x]LT            Yes            (Fülöp et al., 2010)
  wxLNT             Yes                (Fülöp et al., 2010)               w[x]NT              No              (Maletti, 2009)
  wLNT              Yes                   (Kuich, 1999)                     w[x]LNT            Yes                See w[x]LT
              (a) Preservation of forward recognizability                        (b) Preservation of backward recognizability

Table 1: Preservation of forward and backward recognizability for various classes of top-down tree
transducers. Here and elsewhere, the following abbreviations apply: w = weighted, x = extended LHS, L
= linear, N = nondeleting, OQ = open question. Square brackets include a superposition of classes. For
example, w[x]T signifies both wxT and wT.


Algorithm 3 PRODUCE
                                                                      Algorithm 4 REPLACE
 1: inputs
                                                                         1: inputs
 2:    WRTG Gin          = (Nin , ∆, Pin , n0 , M , G) such              2:    y ∈ TΣ (X)
       that M = (Q, Σ, ∆, R, q0 ) is a wxLNT and                         3:    WRTG G = (N, Σ, P, n0 , M , G) in normal form,
       G = (N, Σ, P, n00 , M 0 , G0 ) is a WRTG in normal                      with no chain productions
       form with no chain productions                                    4:    n∈N
 3:    nin ∈ Nin                                                         5: outputs
 4: outputs                                                              6:    set Π of pairs (θ, w) where θ is a mapping
 5:    WRTG Gout = (Nout , ∆, Pout , n0 , M , G), such that                    pos(y) → N and w ∈ R∞       + , each pair indicating
       Gin  Gout and                                                          a successful run on y by productions in G, starting
             w                           w
       (nin −→ u) ∈ Pout ⇔ (nin −        → u) ∈ M (G).                         from n, and w is the weight of the run.
 6: complexity                                                           7: complexity
 7:    O(|R||P |size (ỹ) ), where ỹ is the largest left side tree      8:    O(|P |size (y) )
       in any rule in R
                                                                       9: Πlast ← {({(ε, n)}, 1)}
                                                       w
 8:   if Pin contains productions of the form nin −    → u then       10: for all v ∈ pos(y) such that y(v) 6∈ X in prefix order
 9:       return Gin                                                      do
10:   Nout ← Nin                                                      11:    Πv ← ∅
11:   Pout ← Pin                                                      12:    for all (θ, w) ∈ Πlast do
12:   Let nin be of the form (n, q), where n ∈ N and q ∈ Q.           13:       if M 6= ∅ and G 6= ∅ then
                    w1
13:   for all (q.y −−→    u) ∈ R do                                   14:           G ← PRODUCE(G, θ(v))
                                                                                                 w0
14:       for all (θ, w2 ) ∈ REPLACE(y, G, n) do                      15:      for all (θ(v) −→ y(v)(n1 , . . . , nk )) ∈ P do
15:          Form substitution mapping ϕ : Q × X →                    16:          Πv ← Πv ∪{(θ∪{(vi, ni ), 1 ≤ i ≤ k}, w·w0 )}
             T∆ (N × Q) such that, for all v ∈ yd (y) and q 0 ∈       17:    Πlast ← Πv
             Q, if there exist n0 ∈ N and x ∈ X such that θ(v)        18: return Πlast
             = n0 and y(v) = x, then ϕ(q 0 , x) = (n0 , q 0 ).
                             w ·w2
16:          p0 ← ((n, q) −−1−−→    ϕ(u))
17:          for all p ∈ NORM(p0 , Nout ) do
                                          w                           Algorithm 5 MAKE-EXPLICIT
18:              Let p be of the form n0 −→ δ(n1 , . . . , nk ) for
                 δ∈∆ . (k)                                               1: inputs
19:              Nout ← Nout ∪ {n0 , . . . , nk }                        2:    WRTG G = (N, Σ, P, n0 , M , G) in normal form
20:              Pout ← Pout ∪ {p}                                       3: outputs
                                                                                         0      0     0
21:   return CHAIN-REM(Gout )                                            4:    WRTG G = (N , Σ, P , n0 , M , G), in normal form,
                                                                               such that if M 6= ∅ and G 6= ∅, LG0 = LM (G). , and
                                                                               otherwise G0 = G.
                                                                         5: complexity
G  M (G). . In the latter case, G is a stand-in for                     6:    O(|P 0 |)
M (G). , analogous to the stand-ins for WSAs and                       7:   G0 ← G
WSTs described in Section 2.                                           8:   Ξ ← {n0 } {seen nonterminals}
                                                                       9:   Ψ ← {n0 } {pending nonterminals}
   Algorithm 3, PRODUCE, takes as input a                             10:   while Ψ 6= ∅ do
WRTG   Gin = (Nin , ∆, Pin , n0 , M , G) and a de-                    11:      n ←any element of Ψ
                                                                      12:      Ψ ← Ψ \ {n}
sired nonterminal nin and returns another WRTG,                       13:      if M 6= ∅ and G 6= ∅ then
Gout that is different from Gin in that it has more                   14:         G0 ← PRODUCE(G0 , n)
productions, specifically those beginning with nin                    15:      for all (n −
                                                                                           w
                                                                                           → σ(n1 , . . . , nk )) ∈ P 0 do
that are in M (G). . Algorithms using stand-ins                       16:         for i = 1 to k do
                                                                      17:             if ni 6∈ Ξ then
should call PRODUCE to ensure the stand-in they                       18:                 Ξ ← Ξ ∪ {ni }
are using has the desired productions beginning                       19:                 Ψ ← Ψ ∪ {ni }
with the specific nonterminal. Note, then, that                       20:   return G0
PRODUCE obtains the effect of forward applica-


                                                                  1063


  g0                                                               rJJ .JJ(x1 , x2 , x3 ) −
                                                                                          → JJ(rDT .x1 , rJJ .x2 , rVB .x3 )
      w1
  g0 −−→ σ(g0 , g1 )                                               rVB .VB(x1 , x2 , x3 ) − → VB(rNNPS .x1 , rNN .x3 , rVB .x2 )
      w2
  g0 −−→ α g1 −−→
                   w3
                      α                                            t.”gentle” −  → ”gentle”
                                                                                            (a) Rotation rules
                    (a) Input WRTG G                               iVB .NN(x1 , x2 ) −
                                                                                     → NN(INS iNN .x1 , iNN .x2 )
                                                                   iVB .NN(x1 , x2 ) −
                                                                                     → NN(iNN .x1 , iNN .x2 )
  a0                                                               iVB .NN(x1 , x2 ) −
                                                                                     → NN(iNN .x1 , iNN .x2 , INS)
                   w4
  a0 .σ(x1 , x2 ) −−→ σ(a0 .x1 , a1 .x2 )
                   w5                                                                   (b) Insertion rules
  a0 .σ(x1 , x2 ) −−→ ψ(a2 .x1 , a1 .x2 )
         w6             w7                w8
  a0 .α −−→   α a1 .α −−→    α a2 .α −−→     ρ                     t.VB(x1 , x2 , x3 ) −
                                                                                       → X(t.x1 , t.x2 , t.x3 )
                                                                   t.”gentleman” − → j1
        (b) First transducer MA in the cascade                     t.”gentleman” − → EPS
                                                                   t.INS −
                                                                         → j1
  b0                                                               t.INS −
                                                                         → j2
                   w9                                                                    (c) Translation rules
  b0 .σ(x1 , x2 ) −−→ σ(b0 .x1 , b0 .x2 )
        w10
  b0 .α −−→ α                                                      Figure 3: Example rules from transducers used
       (c) Second transducer MB in the cascade                     in decoding experiment. j1 and j2 are Japanese
                                                                   words.
         w ·w
  g0 a0 −−1−−→4
                σ(g0 a0 , g1 a1 )
         w1 ·w5
  g0 a0 −−−−→ ψ(g0 a2 , g1 a1 )                                    EXPLICIT, which simply generates the full ap-
         w ·w6               w ·w7
  g0 a0 −−2−−→  α g1 a1 −−3−−→     α                               plication WRTG using calls to PRODUCE. The
                                                                   input to MAKE-EXPLICIT is G2 = ({g0 a0 b0 },
 (d) Productions of MA (G). built as a consequence                 {σ, α}, ∅, g0 a0 b0 , MB , G1 ).13 MAKE-EXPLICIT
 of building the complete MB (MA (G). ).
                                                                   calls PRODUCE(G2 , g0 a0 b0 ). PRODUCE then
                                                                                                     w9
  g0 a 0 b 0                                                       seeks to cover b0 .σ(x1 , x2 ) −→      σ(b0 .x1 , b0 .x2 )
             w ·w ·w9
  g0 a0 b0 −−1−−4−−→    σ(g0 a0 b0 , g1 a1 b0 )                    with productions from G1 , which is a stand-in for
             w ·w6 ·w10
  g0 a0 b0 −−2−−−  −−→ α g1 a1 b0 −−3−−−
                                         w ·w7 ·w10
                                                −−→ α              MA (G). . At line 14 of REPLACE, G1 is im-
                                                                   proved so that it has the appropriate productions.
             (e) Complete MB (MA (G). ).                           The productions of MA (G). that must be built
                                                                   to form the complete MB (MA (G). ). are shown
Figure 2: Forward application through a cascade
                                                                   in Figure 2d. The complete MB (MA (G). ). is
of tree transducers using an on-the-fly method.
                                                                   shown in Figure 2e. Note that because we used
                                                                   this on-the-fly approach, we were able to avoid
tion in an on-the-fly manner.11 It makes calls to                  building all the productions in MA (G). ; in par-
REPLACE, which is presented in Algorithm 4, as                                                         w ·w8
                                                                   ticular we did not build g0 a2 −−2−−→       ρ, while a
well as to a NORM algorithm that ensures normal
                                                                   bucket brigade approach would have built this pro-
form by replacing a single production not in nor-
                                                                   duction. We have also designed an analogous on-
mal form with several normal-form productions
                                                                   the-fly PRODUCE algorithm for backward appli-
that can be combined together (Alexandrakis and
                                                                   cation on linear WTT.
Bozapalidis, 1987) and a CHAIN-REM algorithm
that replaces a WRTG containing chain productions                     We have now defined several on-the-fly and
with an equivalent WRTG that does not (Mohri,                      bucket brigade algorithms, and also discussed the
2009).                                                             possibility of embed-compose-project and offline
                                                                   composition strategies to application of cascades
   As an example of stand-in construction, con-
                                                                   of tree transducers. Tables 2a and 2b summa-
sider the invocation PRODUCE(G1 , g0 a0 ), where
                                                                   rize the available methods of forward and back-
G1 = ({g0 a0 }, {σ, ψ, α, ρ}, ∅, g0 a0 , MA , G), G
                                                                   ward application of cascades for recognizability-
is in Figure 2a,12 and MA is in 2b. The stand-in
                                                                   preserving tree transducer classes.
WRTG that is output contains the first three of the
four productions in Figure 2d.                                     5   Decoding Experiments
   To demonstrate the use of on-the-fly application                The main purpose of this paper has been to
in a cascade, we next show the effect of PRO-                      present novel algorithms for performing applica-
DUCE when used with the cascade G ◦ MA ◦ MB ,                      tion. However, it is important to demonstrate these
where MB is in Figure 2c. Our driving al-                          algorithms on real data. We thus demonstrate
gorithm in this case is Algorithm 5, MAKE-                         bucket-brigade and on-the-fly backward applica-
   11                                                              tion on a typical NLP task cast as a cascade of
      Note further that it allows forward application of class
wxLNT, something the embed-compose-project approach did            wLNT. We adapt the Japanese-to-English transla-
not allow.
   12
      By convention the initial nonterminal and state are listed
                                                                      13
                                                                         Note that G2 is the initial stand-in for MB (MA (G). ). ,
first in graphical depictions of WRTGs and WXTTs.                  since G1 is the initial stand-in for MA (G). .


                                                               1064


       method      WST
                    √      wxLNT          wLNT
                                           √     method       WST
                                                              √       wxLT      wLT      wxLNT        wLNT
                                                                                                       √
       oc           √        ×             √     oc           √        ×
                                                                       √         ×
                                                                                 √         ×
                                                                                           √           √
       bb           √        ×
                             √             √     bb           √          √        √            √       √
       otf                                       otf
                (a) Forward application                             (b) Backward application

Table 2: Transducer types and available methods of forward and backward application of a cascade.
oc = offline composition, bb = bucket brigade, otf = on the fly.


tion model of Yamada and Knight (2001) by trans-                    LM type      method        time/sentence
forming it from an English-tree-to-Japanese-string                    pcfg       bucket             28s
model to an English-tree-to-Japanese-tree model.                      pcfg         otf              17s
The Japanese trees are unlabeled, meaning they                       exact       bucket            >1m
have syntactic structure but all nodes are labeled                   exact         otf              24s
“X”. We then cast this modified model as a cas-                      1-sent      bucket             2.5s
cade of LNT tree transducers. Space does not per-                    1-sent        otf              .06s
mit a detailed description, but some example rules
are in Figure 3. The rotation transducer R, a sam-        Table 3: Timing results to obtain 1-best from ap-
ple of which is in Figure 3a, has 6,453 rules, the        plication through a weighted tree transducer cas-
insertion transducer I, Figure 3b, has 8,122 rules,       cade, using on-the-fly vs. bucket brigade back-
and the translation transducer, T , Figure 3c, has        ward application techniques. pcfg = model rec-
37,311 rules.                                             ognizes any tree licensed by a pcfg built from
   We add an English syntax language model L to           observed data, exact = model recognizes each of
the cascade of transducers just described to bet-         2,000+ trees with equal weight, 1-sent = model
ter simulate an actual machine translation decod-         recognizes exactly one tree.
ing task. The language model is cast as an iden-
tity WTT and thus fits naturally into the experimen-      experiment that uses an English PCFG language
tal framework. In our experiments we try several          model. The results for the other two language
different language models to demonstrate varying          models demonstrate more keenly the potential ad-
performance of the application algorithms. The            vantage that an on-the-fly approach provides—the
most realistic language model is a PCFG. Each             simultaneous incorporation of information from
rule captures the probability of a particular se-         all models allows application to be done more ef-
quence of child labels given a parent label. This         fectively than if each information source is consid-
model has 7,765 rules.                                    ered in sequence. In the “exact” case, where a very
                                                          large language model that simply recognizes each
   To demonstrate more extreme cases of the use-
                                                          of the 2,087 trees in the training corpus is used,
fulness of the on-the-fly approach, we build a lan-
                                                          the final application is so large that it overwhelms
guage model that recognizes exactly the 2,087
                                                          the resources of a 4gb MacBook Pro, while the
trees in the training corpus, each with equal
                                                          on-the-fly approach does not suffer from this prob-
weight. It has 39,455 rules. Finally, to be ultra-
                                                          lem. The “1-sent” case is presented to demonstrate
specific, we include a form of the “specific” lan-
                                                          the ripple effect caused by using on-the fly. In the
guage model just described, but only allow the
                                                          other two cases, a very large language model gen-
English counterpart of the particular Japanese sen-
                                                          erally overwhelms the timing statistics, regardless
tence being decoded in the language.
                                                          of the method being used. But a language model
   The goal in our experiments is to apply a single       that represents exactly one sentence is very small,
tree t backward through the cascade L◦R◦I ◦T ◦t           and thus the effects of simultaneous inference are
and find the 1-best path in the application WRTG.         readily apparent—the time to retrieve the 1-best
We evaluate the speed of each approach: bucket            sentence is reduced by two orders of magnitude in
brigade and on-the-fly. The algorithm we use to           this experiment.
obtain the 1-best path is a modification of the k-
best algorithm of Pauls and Klein (2009). Our al-         6   Conclusion
gorithm finds the 1-best path in a WRTG and ad-           We have presented algorithms for forward and
mits an on-the-fly approach.                              backward application of weighted tree trans-
   The results of the experiments are shown in            ducer cascades, including on-the-fly variants, and
Table 3. As can be seen, on-the-fly application           demonstrated the benefit of an on-the-fly approach
is generally faster than the bucket brigade, about        to application. We note that a more formal ap-
double the speed per sentence in the traditional          proach to application of WTTs is being developed,


                                                   1065


independent from these efforts, by Fülöp et al.         Andreas Maletti. 2008. Compositions of extended top-
(2010).                                                     down tree transducers. Information and Computa-
                                                            tion, 206(9–10):1187–1196.
Acknowledgments
We are grateful for extensive discussions with            Andreas Maletti. 2009. Personal Communication.
Andreas Maletti. We also appreciate the in-               Mehryar Mohri, Fernando C. N. Pereira, and Michael
sights and advice of David Chiang, Steve De-               Riley. 2000. The design principles of a weighted
Neefe, and others at ISI in the preparation of             finite-state transducer library. Theoretical Computer
this work. Jonathan May and Kevin Knight were              Science, 231:17–32.
supported by NSF grants IIS-0428020 and IIS-
0904684. Heiko Vogler was supported by DFG                Mehryar Mohri. 1997. Finite-state transducers in lan-
                                                           guage and speech processing. Computational Lin-
VO 1011/5-1.                                               guistics, 23(2):269–312.

                                                          Mehryar Mohri. 2009. Weighted automata algo-
References
                                                           rithms. In Manfred Droste, Werner Kuich, and
Athanasios Alexandrakis and Symeon Bozapalidis.            Heiko Vogler, editors, Handbook of Weighted Au-
  1987. Weighted grammars and Kleene’s theorem.            tomata, chapter 6, pages 213–254. Springer-Verlag.
  Information Processing Letters, 24(1):1–4.
                                                          Adam Pauls and Dan Klein. 2009. K-best A* parsing.
Brenda S. Baker. 1979. Composition of top-down and          In Keh-Yih Su, Jian Su, Janyce Wiebe, and Haizhou
  bottom-up tree transductions. Information and Con-        Li, editors, Proceedings of the Joint Conference of
  trol, 41(2):186–213.                                      the 47th Annual Meeting of the ACL and the 4th In-
                                                            ternational Joint Conference on Natural Language
Zoltán Ésik and Werner Kuich. 2003. Formal tree se-       Processing of the AFNLP, pages 958–966, Suntec,
  ries. Journal of Automata, Languages and Combi-           Singapore, August. Association for Computational
  natorics, 8(2):219–285.                                   Linguistics.
Zoltán Fülöp and Heiko Vogler. 2009. Weighted tree     Fernando Pereira and Michael Riley. 1997. Speech
  automata and tree transducers. In Manfred Droste,         recognition by composition of weighted finite au-
  Werner Kuich, and Heiko Vogler, editors, Handbook         tomata. In Emmanuel Roche and Yves Schabes, ed-
  of Weighted Automata, chapter 9, pages 313–404.           itors, Finite-State Language Processing, chapter 15,
  Springer-Verlag.                                          pages 431–453. MIT Press, Cambridge, MA.
Zoltán Fülöp, Andreas Maletti, and Heiko Vogler.
                                                          William A. Woods. 1980. Cascaded ATN gram-
  2010.       Backward and forward application of
                                                            mars. American Journal of Computational Linguis-
  weighted extended tree transducers. Unpublished
                                                            tics, 6(1):1–12.
  manuscript.
                                                          Kenji Yamada and Kevin Knight. 2001. A syntax-
Ferenc Gécseg and Magnus Steinby. 1984. Tree Au-
                                                            based statistical translation model. In Proceedings
  tomata. Akadémiai Kiadó, Budapest.
                                                            of 39th Annual Meeting of the Association for Com-
Liang Huang and David Chiang. 2005. Better k-best           putational Linguistics, pages 523–530, Toulouse,
  parsing. In Harry Bunt, Robert Malouf, and Alon           France, July. Association for Computational Lin-
  Lavie, editors, Proceedings of the Ninth Interna-         guistics.
  tional Workshop on Parsing Technologies (IWPT),
  pages 53–64, Vancouver, October. Association for
  Computational Linguistics.
Werner Kuich. 1998. Formal power series over trees.
  In Symeon Bozapalidis, editor, Proceedings of the
  3rd International Conference on Developments in
  Language Theory (DLT), pages 61–101, Thessa-
  loniki, Greece. Aristotle University of Thessaloniki.
Werner Kuich. 1999. Tree transducers and formal tree
  series. Acta Cybernetica, 14:135–149.
Andreas Maletti, Jonathan Graehl, Mark Hopkins, and
  Kevin Knight. 2009. The power of extended top-
  down tree transducers. SIAM Journal on Comput-
  ing, 39(2):410–430.
Andreas Maletti. 2006. Compositions of tree se-
  ries transformations. Theoretical Computer Science,
  366:248–271.


                                                      1066
